<%- include("../partials/html-head") %>
<link
href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
rel="stylesheet"
integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
crossorigin="anonymous"
/>
<%- include("../partials/nav") %>

<header class="p-3 bg-dark text-white">
  <nav class="container">
    <div
      class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start"
    >
      </form>
      <div class="text-end d-flex align-items-center">
        <% // TODO: Add login logic here %>
        <% if (user) { %>
          <a href="/auth/logout">
            <button type="submit" class="btn btn-warning">Logout</button>
          </a>
        <% } else { %>
          <a href="/auth/google">
            <button type="submit" class="siwg">
              <img id="siwg-image" src="" alt="Sign in with Google" />
            </button>
          </a>
        <% } %>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="container">
  <h2 class="mt-3 mb-3">Students</h2>
  <% students.forEach(function(student) { %>
    <div class="card mb-3 bg-dark text-white">
      <div class="row g-0">
        <div class="col-md-2">
          <% if (student.avatar) { %>
            <img 
              src="<%= student.avatar %>" 
              alt="<%= student.name %> profile"
              class="img-fluid rounded-start"
            />
          <% } else { %>
            <img 
              src="/images/user.png" 
              alt="placeholder avatar"
              class="img-fluid rounded-start"
            >
          <% } %> 
        </div>
        <div class="col-md-10">
          <div class="card-body">
            <h3 class="card-title"><%= student.name %></h3>
            <ul>
              <% student.facts.forEach(function(fact) { %>
                <li class="card-text">
                  <form action="/facts/<%= fact._id %>?_method=DELETE" method="POST">
                    <button>X</button>
                  </form>
                  <%= fact.text %></li>
              <% }) %>
            </ul>
            <% // Add dynamic UI form below this line %>
            <% if (student._id.equals(user?.studentProfile._id)) { %>
              <div class="card-footer">
                <form
                  action="/students/facts"
                  method="POST"
                  class="input-group"
                >
                  <input
                    type="text"
                    name="text"
                    class="form-control form-control-dark"
                    placeholder="Add a fact..."
                    autocomplete="off"
                    required
                  />
                  <button type="submit" class="btn btn-primary">
                    Add Fact
                  </button>
                </form>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>

<%- include("../partials/footer") %>